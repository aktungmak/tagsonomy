bundle:
  name: tagsonomy

variables:
  database_instance_name: 
    default: tagsonomy-db

targets:
  dev:
    mode: development
    default: true
    
  prod:
    mode: production
    workspace:
      root_path: /Workspace/.bundles/prod/${bundle.name}
    run_as:
      # Uncomment and set if using service principal for production
      # service_principal_name: ${DATABRICKS_SERVICE_PRINCIPAL}

resources:
  apps:
    tagsonomy-app:
      name: mcp-tagsonomy-app
      source_code_path: tagso
      resources:
        - name: lakebase
          database:
            instance_name: ${resources.database_instances.tagsonomy-instance.name}
            # database_name: ${resources.database_catalogs.tagsonomy-catalog.database_name}
            database_name: tagsonomy
            permission: CAN_CONNECT_AND_CREATE
        - name: sync-tags-job
          job:
            id: ${resources.jobs.sync-tags.id}
            permission: CAN_MANAGE_RUN

  database_instances:
    tagsonomy-instance:
      name: ${var.database_instance_name}
      capacity: CU_1
  # database_catalogs:
  #   tagsonomy-catalog:
  #     database_instance_name: ${resources.database_instances.tagsonomy-instance.name}
  #     name: tagsonomy-catalog
  #     database_name: tagsonomy
  #     create_database_if_not_exists: true
  jobs:
    sync-tags:
      name: sync-ontology-tags
      max_concurrent_runs: 1

      tasks:

        - task_key: run_script
          notebook_task:
            notebook_path: jobs/sync_tags.ipynb
          environment_key: default
          max_retries: 0
      environments:
        - environment_key: default
          spec:
            client: "4"
