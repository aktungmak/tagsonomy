{% extends "base.html" %}

{% block title %}Tagsonomy | Concepts{% endblock %}

{% block head_scripts %}
<script>
    window.TAGSO_CONFIG = {
        conceptDeleteUrl: '{{ url_for("concepts.concept_delete") }}',
        userNs: '{{ user_ns }}'
    };
</script>
{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('DOMContentLoaded', function() { 
        filter_concepts();
    });
</script>
{% endblock %}

{% block content %}
<input type="search" 
       id="concept_search" 
       value="{{ concept_uri }}" 
       onkeyup="filter_concepts()" 
       placeholder="Search for concepts...">

<ul id="concept_list">
    {% for concept in concepts %}
    <li>
        <span class="alt-labels-search" hidden>{{ concept.alt_labels | join(' ') }}</span>
        <div>
            <b>URI:</b> <span>{{ concept.uri | safe }}</span>
        </div>
        <div>
            <b>Label:</b> <span>{{ concept.label | safe }}</span>
        </div>
        {% if concept.alt_labels %}
        <div>
            <b>Alternative Labels:</b>
            <ul>
                {% for alt_label in concept.alt_labels %}
                <li>{{ alt_label | safe }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        <div>
            <b>Assigned Tables:</b>
            {% if concept.assigned_tables %}
            <ul>
                {% for assignment in concept.assigned_tables %}
                <li><a href="{{ url_for('tables.tables_get', table_uri=assignment.table_uri) }}">{{ assignment.table_name | default(assignment.table_uri, true) | safe }}</a> ({{ assignment.table_uri | safe }})</li>
                {% endfor %}
            </ul>
            {% else %}
            <span>None</span>
            {% endif %}
        </div>
        {% if concept.related_properties %}
        <div>
            <b>Related Properties:</b>
            <ul>
                {% for prop in concept.related_properties %}
                <li><a href="{{ url_for('properties.properties_get', property_uri=prop.uri) }}">{{ prop.name | default(prop.uri, true) | safe }}</a> ({{ prop.role }})</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        <a href="{{ url_for('concepts.concept_edit_get', uri=concept.uri) }}"><button type="button">Edit</button></a>
        <button onclick="delete_concept('{{ concept.uri }}')">Delete</button>
        <a href="{{ url_for('assign.assign_get', selected_concept_uri=concept.uri) }}"><button type="button">Assign</button></a>
    </li>
    {% endfor %}
</ul>

<hr/>

<h2>New Concept</h2>
<form action="{{ url_for('concepts.concepts_post') }}" method='post'>
    <label for="label">Label:</label>
    <input type="text" name="label" id="label" oninput="update_uri_from_label()" required/>
    
    <label for="uri">IRI:</label>
    <input type="text" name="uri" id="uri"/>

    <label for="comment">Comment:</label>
    <input type="text" name="comment" id="comment"/>
    
    <label>Alternative Labels (skos:altLabel):</label>
    <div id="new_concept_alt_labels_container"></div>
    <button type="button" onclick="addAltLabelField('new_concept_alt_labels_container')">Add Alternative Label</button>

    <input type="radio" name="type" id="rdfs_class" value="rdfs_class" checked>
    <label for="rdfs_class">RDFS Class</label>
    <input type="radio" name="type" id="skos_concept" value="skos_concept">
    <label for="skos_concept">SKOS Concept</label>
    
    <input type="submit" value="Create"/>
</form>
{% endblock %}

