{% extends "base.html" %}

{% block title %}Tagsonomy | Tables{% endblock %}

{% block extra_head %}
<script>
    function filter_tables() {
      input = document.getElementById('table_search');
      filter = input.value.toUpperCase();
      ul = document.getElementById("table_list");
      li = ul.getElementsByTagName('li');

      for (i = 0; i < li.length; i++) {
        spans = li[i].getElementsByClassName('searchable');
        txt = '';
        for (j = 0; j < spans.length; j++) {
          txt += spans[j].textContent || spans[j].innerText;
        }
        if (txt.toUpperCase().indexOf(filter) > -1) {
          li[i].style.display = "";
        } else {
          li[i].style.display = "none";
        }
      }
    }

    function delete_table(table_uri) {
      if (confirm('Are you sure you want to delete this table?')) {
        fetch('{{ url_for("table_delete") }}', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ uri: table_uri })
        })
        .then(response => {
          if (response.ok) {
            window.location.reload();
          } else {
            alert('Error deleting table');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error deleting table');
        });
      }
    }

    window.addEventListener('DOMContentLoaded', function() { 
      filter_tables(); 
    });
</script>
{% endblock %}

{% block content %}
<input type="text" 
       id="table_search" 
       value="{{ table_uri }}" 
       onkeyup="filter_tables()" 
       placeholder="Search for tables...">

<ul id="table_list">
    {% for table in tables %}
    <li>
        <div>
            <b>URI:</b> <span class="searchable">{{ table.uri | safe }}</span>
        </div>
        <div>
            <b>Name:</b> <span class="searchable">{{ table.name | safe }}</span>
        </div>
        <div>
            <b>Related Classes:</b> <span>TODO</span>
        </div>
        <div>
            <b>Related Properties:</b> <span>TODO</span>
        </div>
        <button onclick="delete_table('{{ table.uri }}')">Delete</button>
        <button onclick="assign('{{ table.uri }}')">Assign</button>
    </li>
    {% endfor %}
</ul>

<hr/>

<h2>New Table</h2>
<form action="{{ url_for('tables_post') }}" method='post'>
    <label for="name">Table name:</label>
    <input type="text" name="name" id="name" required/>
    
    <label for="uri">Table IRI (optional):</label>
    <input type="text" name="uri" id="uri"/>
    
    <input type="submit" value="Create"/>
</form>
{% endblock %}
